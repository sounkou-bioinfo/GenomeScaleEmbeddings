
# GenomeScaleEmbeddings

## Load the package

``` r
library(GenomeScaleEmbeddings)
library(knitr)
library(httr2)
library(jsonlite)
library(dplyr)
#> 
#> Attaching package: 'dplyr'
#> The following objects are masked from 'package:stats':
#> 
#>     filter, lag
#> The following objects are masked from 'package:base':
#> 
#>     intersect, setdiff, setequal, union
library(ggplot2)
```

## 1. Peek into remote parquet files

``` r
# Use OpenRemoteParquetView to inspect the first few rows
OpenRemoteParquetView()
#> # Source:   table<embeddings> [?? x 6]
#> # Database: DuckDB 1.4.0 [root@Linux 6.8.0-78-generic:R 4.5.1//tmp/RtmpaC1oPN/file8a11b57b47c4c.duckdb]
#>    chrom pos       ref_UKB alt_UKB rsid       embedding    
#>    <chr> <chr>     <chr>   <chr>   <chr>      <list>       
#>  1 5     148899362 T       G       rs4705280  <dbl [3,072]>
#>  2 5     148899764 C       T       rs6872985  <dbl [3,072]>
#>  3 5     148900624 C       A       rs1181141  <dbl [3,072]>
#>  4 5     148901339 C       T       rs1181139  <dbl [3,072]>
#>  5 5     148902146 G       T       rs4705282  <dbl [3,072]>
#>  6 5     148902250 G       A       rs10036926 <dbl [3,072]>
#>  7 5     148903759 C       T       rs17108911 <dbl [3,072]>
#>  8 5     148904179 C       A       rs1181137  <dbl [3,072]>
#>  9 5     148904381 T       G       rs4705283  <dbl [3,072]>
#> 10 5     148906034 C       T       rs1181135  <dbl [3,072]>
#> # â„¹ more rows
```

## 2. Copy remote parquet files into local DuckDB

``` r
system.time(

CopyParquetToDuckDB(db_path = "local_embeddings.duckdb", overwrite = FALSE)
)
#> Database file 'local_embeddings.duckdb' already exists. Skipping copy.
#>    user  system elapsed 
#>   0.029   0.004   0.029
file.info("local_embeddings.duckdb")$size
#> [1] 12106084352
```

## 3. Write embeddings to houba mmatrix

``` r
system.time(

houba <- writeEmbeddingsHoubaFromDuckDB(dbPath = "local_embeddings.duckdb", 
overwrite = FALSE)
)
#> Warning in mk.descriptor.file(object@file, object@dim[1], object@dim[2], :
#> local_embeddings.houba.desc already exists.
#> Using existing houba file and info data.
#>    user  system elapsed 
#>   0.557   0.062   0.577
houba
#> Houba mmatrix file: local_embeddings.houba 
#> Embeddings (houba::mmatrix):
#> A read-only mmatrix with 616386 rows and 3072 cols
#> data type:  double 
#> File: local_embeddings.houba 
#> --- excerpt
#>              [,1]       [,2]        [,3]         [,4]         [,5]
#> [1,] -0.008660397 0.02568399 -0.01839902 -0.001554275 -0.014016987
#> [2,] -0.003067377 0.01635006 -0.02215753  0.003889058 -0.013320981
#> [3,] -0.002486568 0.04113422 -0.01771097  0.024944620 -0.022576459
#> [4,] -0.002763281 0.02626457 -0.01791935  0.010160015 -0.011453237
#> [5,] -0.013722803 0.02826897 -0.01959616 -0.005454814 -0.009612823
#> 
#> Info data.frame (first 10 rows):
#>    chrom       pos ref_UKB alt_UKB       rsid
#> 1      5 148899362       T       G  rs4705280
#> 2      5 148899764       C       T  rs6872985
#> 3      5 148900624       C       A  rs1181141
#> 4      5 148901339       C       T  rs1181139
#> 5      5 148902146       G       T  rs4705282
#> 6      5 148902250       G       A rs10036926
#> 7      5 148903759       C       T rs17108911
#> 8      5 148904179       C       A  rs1181137
#> 9      5 148904381       T       G  rs4705283
#> 10     5 148906034       C       T  rs1181135
file.info("local_embeddings.houba")$size
#> [1] 15148302336
```

## 4. Run PCA on houba mmatrix

``` r
system.time(
  pca_res <- houbaPCA("local_embeddings.houba")
)
#> Attached big.matrix from descriptor file: local_embeddings.houba.desc
#> Dimensions: 616386 x 3072
#> Running PCA with center=TRUE, scale=TRUE, ncomp=15
#>    user  system elapsed 
#> 361.102 118.134  54.795
```

## 5. Get PCA scores

``` r
pc_scores <- getPcaScores(pca_res)
object.size(pc_scores)
#> 73966536 bytes
```

## 6. Plot PCA dimensions (PC1 vs PC2, colored by chromosome)

``` r
plotPcaDims(pc_scores, houba$info, annotation_col = "chrom", dim1 = 1, dim2 = 2)
```

<img src="docs/README-unnamed-chunk-8-1.png" width="100%" />

## 7. Annotate variants with coffee consumption GWAS and plot PC1 vs PC2 by gene

``` r
# Helper function to fetch and extract annotation
gen_phenotype_anno <- function(phenotype_term) {
  query <- utils::URLencode(paste0("https://rest.ensembl.org/phenotype/term/homo_sapiens/", phenotype_term))
  resp <- request(query) |>
    req_headers("Content-Type" = "application/json") |>
    req_perform()
  json <- resp_body_json(resp)
  lapply(json, function(x) {
    if (!is.null(x$Variation)) {
      data.frame(
        rsid = x$Variation,
        gen = if (!is.null(x$attributes$associated_gene)) x$attributes$associated_gene else NA,
        stringsAsFactors = FALSE
      )
    }
  }) |> bind_rows()
}

# Fetch annotation data frames using helper function
coffee_anno <- gen_phenotype_anno("coffee consumption")
preeclampsia_anno <- gen_phenotype_anno("preeclampsia")
ckd_anno <- gen_phenotype_anno("chronic kidney disease") |> rename(gen_ckd = gen)

# Merge PCA scores and houba info
plotDf <- cbind(pc_scores,houba$info)
names(plotDf)[1:15] <- paste0("PC",1:15)

# Annotate plotDf with coffee, preeclampsia, and CKD
plotDf <- plotDf |>
  left_join(coffee_anno, by = c("rsid" = "rsid")) |>
  left_join(preeclampsia_anno, by = c("rsid" = "rsid"), suffix = c("_coffee", "_preeclampsia")) |>
  left_join(ckd_anno, by = c("rsid" = "rsid"), suffix = c("", "_ckd"))

# Subset for coffee, preeclampsia, and CKD SNPs
coffee_snps <- subset(plotDf, !is.na(gen_coffee))|>
        unique()
preeclampsia_snps <- subset(plotDf, !is.na(gen_preeclampsia))|>
        unique()
ckd_snps <- subset(plotDf, !is.na(gen_ckd)) |>
        unique()
ckd_snps
#>                PC1          PC2         PC3         PC4          PC5        PC6
#> 17694   -8.1707296  -1.88110893  -0.6203109 -19.3518349  -7.26099463 15.9834875
#> 17707  -15.1074108  -5.40505181   0.7885761 -18.9798407  -9.95432103 14.8730155
#> 17712   14.6873125   0.62915141   0.8211190 -18.1659749  -9.72401461 15.8256590
#> 17713   14.6873125   0.62915141   0.8211190 -18.1659749  -9.72401461 15.8256590
#> 36481  -10.2005509  -3.82142856  -1.8724349 -22.9800034 -10.47307794 13.7570702
#> 38806  -11.1594742  -2.25782428   1.9471137 -14.6123142  -9.85128792  7.7954153
#> 98368  -19.2885600   5.61109719  22.3103538   2.6059541   4.50176286  6.6867847
#> 98473   18.9819389   8.06190346  17.3092370   1.1247930   7.96556327  8.9105885
#> 114743  16.1335753   5.29571936  19.2747163   3.0311373   6.20756077  5.8585342
#> 124749  18.8258659   7.45439188  18.8059789   3.0852722   5.16441261  6.7037806
#> 124775  16.4087049   7.92371706  19.6836119   2.4810578   5.95584585 12.1408469
#> 124777  18.1383882   6.27419730  17.4768243   3.2202185   4.77404360  6.8728248
#> 124788  18.8762203   6.14003907  18.8723139   5.0966832   3.71022620  7.0764404
#> 124792  17.7350779   4.77401546  16.6554100   4.3862050   2.47093060  6.4235395
#> 124800   0.9508051   3.66305112  18.7048505   8.3024639   4.80184481  3.1465195
#> 125080  14.1169834   5.45218722  19.5992411   2.0970093   5.73580295 13.3869283
#> 140728  18.5474976   4.26802669  18.5919938   5.7715276   4.05249853 17.8654015
#> 184948 -12.8460678   8.41395564  18.5275873   1.4826624   5.21452451 14.3556847
#> 193827  17.1908924  18.28810347  -9.6962566  -7.6161654  13.23137552  1.4986244
#> 193830  -1.8875292  18.90126650 -13.7620366  -7.8586443  14.67115064  5.2543496
#> 194543  20.7505822  17.92814976 -15.4445109 -10.4507828  17.68844316  7.9745586
#> 194848  17.3844595  18.06908334 -12.3389516 -13.7413227  10.67127497 -0.4921044
#> 198844  -4.3398137  14.07584268 -10.2139275  -9.4071964  17.11025476  8.9327446
#> 210679  16.5118557  19.56028530 -10.6668968  -8.8730870  11.35142359  2.3056846
#> 215696  15.1865044  18.05171406 -12.4565138  -7.6214521  18.54427474  0.6606322
#> 243283 -16.8318017  17.87814694 -10.4848613  -6.5522146  15.71491159 -0.6924643
#> 254606 -16.0882349  12.53065983  -7.5744633 -13.4858717  14.52059885 12.0338778
#> 254626  -2.9075740  15.70709291 -11.4747899 -10.8729962  16.23241475  3.8473013
#> 255308 -12.8057703  19.50619646 -12.2851688  -9.9078302  19.50257201  5.7566127
#> 280318  19.6479964  -1.71290777 -12.3946386  11.9400960   1.42154702 11.2111641
#> 295522 -16.6499217  -4.05981689 -11.0419740  14.6750710  -2.29249583  8.0186504
#> 295524  17.1293726  -2.63673263 -11.2175684  13.2256866  -3.83212785  3.3822631
#> 300234 -15.8630236  -0.26204662 -11.1405401  13.7647201  -2.06575122 10.3772089
#> 305533  15.6746291  -0.10152447 -10.5229240   7.3415374   1.90950310 19.0891336
#> 346098 -11.9214303  -2.58929657 -11.6703706  11.9185558  -1.00693794 14.3742954
#> 350168  15.1013844  -0.11365375 -11.9964461  11.8337390  -2.67374758 15.6443484
#> 393593  -1.5754886   2.04947271  -1.3964159   2.3219703   5.27613444 16.9814277
#> 398552 -17.1237032  -0.62341839  -3.3957887   6.1514464   2.46753823  9.7266345
#> 405470  21.5038992  -0.01269771  -3.2684386   4.3824922   3.82919039 14.0771358
#> 422359   4.4090204   1.21808442  -3.2409320   4.2636164   0.24823150 12.9539599
#> 425594   8.0204083  -0.74006294  -4.1686374   2.0095085   5.17978866 19.9522831
#> 431874  19.2119532   1.20149302  -4.8040380  -4.7649066   3.33947148 11.8561335
#> 436568   6.1642755   1.33505483  -0.3710476  -5.7887638  -2.62211212  8.3671210
#> 441143  10.8535263 -19.76563489   0.1456441   9.1293784   5.80758786 11.5374337
#> 453810  13.5403797 -19.05511863  -4.5127613   4.0392236   2.76199030 13.3174776
#> 470261 -12.8309928 -19.68759103  -4.0883615   8.0419421  -1.88655301  4.3461918
#> 504292  20.7230308 -15.66379092  -1.5403506  -4.1942957  10.13142821  4.2426386
#> 505713 -15.7027593 -18.71037144   2.5466590  -5.7830766  16.05040503 16.4898356
#> 505785 -17.0524989 -14.87486149  -4.0238391  -0.1718643  10.65450456  7.3761177
#> 505786 -17.0524989 -14.87486149  -4.0238391  -0.1718643  10.65450456  7.3761177
#> 522142 -10.6400036   1.71778314  -0.5889791  -9.0343820   1.17291878 17.5471804
#> 522616 -15.4662742   1.56003271  -1.7107821  -5.9384123  -3.04418928 10.6930758
#> 522629 -14.4325301  -1.43906079  -2.0257378  -5.4064870  -0.35959907 17.7653477
#> 534351  19.9400923 -18.35227688   5.9209982 -13.0968862  16.71369735 -5.1855934
#> 545314  19.5774266 -20.50486778   3.9050698 -11.3742734  15.31923626 -5.8674763
#> 549435 -14.7834028 -22.59057911   4.8308446 -12.9377833  18.78217616 -4.1258170
#> 554416  16.6819654 -24.21521981   6.3475716 -11.4076003  18.69654633 -8.1508529
#> 559149  20.8129401 -16.88471075   6.1137166 -10.4776483  15.60311270 -7.7588935
#> 563049 -15.6636305 -22.18769669   6.6315487 -11.9301128  15.25270569 -8.5402011
#> 578225 -15.8250258   0.65309209   0.1119929  -2.0263631  -0.03830282  1.7186844
#> 590556  22.8809711  -6.99485725  -1.4069129 -11.4693446  11.62998784  9.5666883
#> 604260 -14.1293126  -7.37495766  -4.8011699  -7.0568948  13.36619200  5.6231758
#> 604270  16.1012272  -9.41560597  -4.5823575 -12.1460819  15.44472353 10.7654580
#>                PC7          PC8          PC9         PC10         PC11
#> 17694   -3.3321155  -1.02505853   5.83789911  -1.33758396  -4.58364437
#> 17707   -3.9240707   2.17382803   3.50380294  -6.47218428  -9.54747876
#> 17712   -1.8492478   1.82172617   5.21899180  -2.13655889  -3.15366511
#> 17713   -1.8492478   1.82172617   5.21899180  -2.13655889  -3.15366511
#> 36481   -2.4800011   1.68558334   9.56225065  -2.51952312  -8.82298480
#> 38806   -1.5835267   4.63618581  10.49623203  -8.47912164 -10.29985089
#> 98368   -4.1439265   2.93956967   2.72052136  -4.24359985  -5.52586152
#> 98473   -4.1240230   5.88188762   8.26709427  -4.82180644  -1.01945781
#> 114743  -4.3651303   4.76608542  -0.81977453  -4.03515504  -6.99276638
#> 124749  -6.2961443   1.12332514  -1.10260280  -5.73712727  -9.81607708
#> 124775  -6.5490042   2.27669438   4.16181131  -5.77501554  -5.83446920
#> 124777  -4.3477929   2.38736458  -1.31198319  -6.84923356  -9.61660530
#> 124788  -7.0746854   3.66639784  -1.52248898  -5.27505325  -8.38400308
#> 124792  -6.1079024   1.42295451   3.20604642  -8.67379203  -8.22614858
#> 124800  -4.0344218  -0.30253410  13.48350612 -14.08434884  -5.00385701
#> 125080  -2.1891304  -1.21679418  10.57304194   9.20045071   5.65220780
#> 140728 -12.4377297   2.56458638  -3.31476998  -2.30649636   8.87535163
#> 184948  -6.3279498   1.63826489   0.33502242  -3.02774541  14.81210716
#> 193827  -7.7643503   0.29799303  -4.73599332  -2.25096122  -7.16558374
#> 193830  -7.1431129  -0.16981756   8.86545363  -2.97329208  -2.61680028
#> 194543 -10.6670924  -4.27913089   3.22216501  -1.69808797  -5.13040912
#> 194848  -2.2834902  -4.34510536   6.69172575  -9.12151751  -0.28575328
#> 198844  -3.8570517  -1.60170867  17.39691877 -12.93786048  -0.05041504
#> 210679  -5.9423748  -2.98456650  -9.73684996  -6.68573824  11.00792100
#> 215696  -5.7601932  -1.40589390   2.33461361  -7.18122657  -3.21709280
#> 243283  -6.3725771  -5.36426497   2.86729398   6.33089349  -1.84481651
#> 254606  -5.5245955  -2.03876185  -2.81255864   2.64194505  -9.08058152
#> 254626  -0.2457480  -3.10649647  14.15116640  -3.40196382  -1.54031303
#> 255308  -7.1559434  -5.17123539  10.57830479   8.91194085  -0.29119665
#> 280318  -5.4431778  11.53404432   4.74125008   1.53035432  -1.01221695
#> 295522  -5.8617157   7.25615512  15.69163374   6.36649791  -0.18010585
#> 295524  -2.8806704   4.58866135  12.11576095   3.56639939  -2.51192288
#> 300234  -6.5514526   9.06070307   8.61449999   9.54884677  -0.36183445
#> 305533  -3.5273918  11.50693082   7.13341347  -7.31798327   3.13089470
#> 346098  -9.1006487  14.82451089   4.76573862  11.21323810   4.44988599
#> 350168  -8.4187332  15.91851509  -2.17522184  -3.74310429   5.14064256
#> 393593  20.3918555   0.34535050  16.19795395   0.61914343   9.43956159
#> 398552  14.8954891   1.22610020  -6.04255534  -6.49991607   8.09782988
#> 405470  17.9918041  -2.54556291   9.22010639   5.34021053   0.33261893
#> 422359  15.8325404   0.85832548 -21.27939229  -0.40777269   6.27829804
#> 425594  14.8044793   2.87505064   4.60012993  -6.38420845  -2.08478315
#> 431874   5.1497305  -3.58306196   9.42495062   7.63774027  -0.91343470
#> 436568   1.6421624  -0.32403240  -8.68413827  13.67242642 -14.24973015
#> 441143  -8.9414567 -15.17778175   7.47707829  -7.07071880  -6.65468304
#> 453810 -14.0663401 -12.75305644 -10.85705233  -1.11473417  -3.08892017
#> 470261 -10.3765359 -16.94097160   1.10184196   5.79444432  -1.31963528
#> 504292   9.9994446  -8.23724207  -0.05026466   8.43352019  -0.21778548
#> 505713   7.4825501  -5.83973050  -2.91514557  -2.33136381   2.82029922
#> 505785  10.5915771  -3.20011860  -6.73796644   0.03515606  -5.03246642
#> 505786  10.5915771  -3.20011860  -6.73796644   0.03515606  -5.03246642
#> 522142   2.5355796   0.07591177   1.84296760   8.01421036  -4.87239530
#> 522616  -2.4045465   1.20345589   3.66857555   9.63222580  -9.44975247
#> 522629  -5.0533659   6.33470185   6.24597384   1.47186628  -9.77998726
#> 534351  -0.8425488  17.28002054   1.16322415  -2.65354272  -2.54497776
#> 545314  -3.2762345  18.18985798  -1.12072877  -1.64455742  -6.42090444
#> 549435  -2.0173374  16.86991437  -2.29851542   0.45843208  11.34496715
#> 554416  -1.8214956  15.29219497   5.93190403   7.91850032   6.11119025
#> 559149  -2.2903515  15.28780539   0.69791673  -1.69929137  -6.64868843
#> 563049  -4.8086150  17.93584035  -3.59950514  -3.79112175  10.02474981
#> 578225   4.5970644   0.58979875   6.35189541   4.17180519  -2.35171363
#> 590556   0.7616795   2.48120263   6.37006940   3.23107798   3.30209115
#> 604260  -0.4746661   1.24871963  -0.12863324  -5.90857622   7.25686632
#> 604270  -3.2607632   3.83402164   0.55293723  -7.62733660  10.75927498
#>               PC12        PC13         PC14         PC15 chrom       pos
#> 17694    5.3962461  2.33084215  -2.46005079   4.47065273     5 177361569
#> 17707    1.6916309  0.01324786   4.28080801  -1.04024199     5 177386403
#> 17712    2.5260012 -0.16911538  -1.90534706   4.74718490     5 177390635
#> 17713    2.5260012 -0.16911538  -1.90534706   4.74718490     5 177390635
#> 36481    7.3641629 -1.19330979  -0.88990356  -8.72651616     5  35037010
#> 38806    1.9754195 -3.91499282  -4.34073533  -5.62462485     5  39378013
#> 98368   -5.3991330  3.41136698   0.79757006   6.59163975     6 160122116
#> 98473   -3.8911987  2.70979114  -5.04639356  -1.37530885     6 160247357
#> 114743   0.1631395  1.15080983  -1.00847697  -2.33749795     6  11028421
#> 124749   4.7908075 -0.66082490  -2.40599826  -0.31942063     6  25770638
#> 124775  -0.1470745 -0.29325800  -1.29331939   1.72310793     6  25794203
#> 124777   1.4804533  0.48450306   0.77609758   3.32966375     6  25799448
#> 124788   1.6449216  1.89545307   0.77036733  -0.36387141     6  25818527
#> 124792  -0.6620510  3.33816339  -1.62986463   3.84254712     6  25818538
#> 124800   1.3849592  2.05264981   1.04938669   4.53530194     6  25821388
#> 125080  -1.3199656  4.19639718   1.39991796  -1.73470695     6  26185972
#> 140728   3.4325041 -3.38383432  -0.79046677  -3.64010360     6  43838872
#> 184948  -5.1709909 -0.14242343   1.51979464   3.70300225     6 134503073
#> 193827   2.0622341  2.46278078  -0.80944782   6.43841144     7 150842165
#> 193830   2.2680049  0.42477212  -1.74935475   5.24047575     7 150845427
#> 194543  -1.3833165  1.25219545   0.10733521  -0.94144222     7 151710715
#> 194848  -2.4835595 -0.02834495   2.77412145   4.01821779     7 152013462
#> 198844  -4.0779897  5.56212951  -3.84581324   1.02262730     7 157757146
#> 210679  -3.9867186  0.76839288  -0.81426658   5.73798061     7  15693493
#> 215696   0.8143015 -2.93695033  -0.09107121  -1.75215424     7  22474434
#> 243283   1.9013630  0.17793119   1.28454685  -1.19988138     7  77787122
#> 254606   9.1400465 -1.33169704   2.83110672  -4.52577614     7  99672916
#> 254626   8.1682554 -3.44633582   1.94403104  -1.44944770     7  99735325
#> 255308  -1.7666501 -0.85122841   2.95270028   2.58292660     7 101192604
#> 280318   6.4852861  5.42924287  -1.05495510  -2.45926182     8   1891807
#> 295522  -3.8311295  3.16757416  -2.18102374  -1.65853894     8  18414928
#> 295524  -3.9762580  4.27932237   2.26046338   2.34409722     8  18415371
#> 300234  -4.8823432  2.67871847   6.13270379   1.19090205     8  23893638
#> 305533   0.4886822  0.44759104   7.38837259   1.69697238     8  32554841
#> 346098  -1.1503114  5.06045141   1.91701512   1.46150014     8 121610260
#> 350168   1.1471793  1.61238031   2.14545667   2.09734008     8 128059915
#> 393593  -2.0333307 -4.94582912   1.90836605  -0.84573736     9  76423254
#> 398552  -6.4140612 -5.92962067  -1.92087339   0.94896806     9  84611173
#> 405470  -1.0652904 -5.99816305  -2.69763248   0.23971745     9  96167968
#> 422359  -5.6933819 -3.40620820  -6.11588318  -0.39321464     9 122458945
#> 425594  -0.7895130 -6.49566795  -4.45188406  -1.94034584     9 129112362
#> 431874 -10.4078384  1.86021970   7.48287894  10.67681649     1  99937719
#> 436568 -14.9775523  3.20664552  11.57375673  10.73455844     1 109457216
#> 441143   1.7840722 -3.32413133   1.73917545   0.04372362    18    673086
#> 453810  -3.4717703 -3.85934742  -0.80509598   0.75802464    18  26813249
#> 470261  -1.5858874 -5.50798442   0.93067355   1.75593174    18  57097183
#> 504292  13.0540108 20.17731076  -2.17901002   2.23482103    19  29914778
#> 505713  15.5397808 15.36179694  -0.38348756   1.39252442    19  32692906
#> 505785  14.3361947 12.90555790  -3.13760751   4.65429496    19  32865985
#> 505786  14.3361947 12.90555790  -3.13760751   4.65429496    19  32865985
#> 522142 -13.9686136  6.88854691  13.81604237  16.18058765     1 150979001
#> 522616 -13.1958536  3.56473552  12.63977529  17.73515773     1 151967388
#> 522629 -12.5481919  2.33977499  11.93854678  17.55613871     1 151982754
#> 534351   1.6796840 -4.38207063  -1.44149826   0.65795897    20   2510563
#> 545314  -2.7687459 -4.22202595 -10.08062102   1.56564132    20  17376928
#> 549435  -5.1200326 -6.78216273  -0.09140363  -0.03783004    20  23632100
#> 554416  -0.3019794 -7.57028999   1.11496571  -0.62686709    20  39061821
#> 559149   3.4818633 -4.53647452  -2.39366244   2.80684086    20  46659814
#> 563049  -0.7168325 -6.89731094  -3.94302482   3.05483677    20  52676385
#> 578225 -19.0145763 12.22882416  -5.11852826  -7.45803187     2 163327819
#> 590556  -7.3638422  3.11519634  22.19556729 -11.81661751    21  15204463
#> 604260  -5.1599505 -1.29198469  20.64106607 -15.48346962    21  27362678
#> 604270  -6.6769960 -1.48146205  24.80044827 -14.12812144    21  27372037
#>        ref_UKB alt_UKB       rsid gen_coffee gen_preeclampsia
#> 17694        C       T  rs4976646       <NA>             <NA>
#> 17707        T       C  rs3812036       <NA>             <NA>
#> 17712        G       A  rs6420094       <NA>             <NA>
#> 17713        G       A  rs6420094       <NA>             <NA>
#> 36481        T       C    rs37369       <NA>             <NA>
#> 38806        T       C  rs1362800       <NA>             <NA>
#> 98368        T       C rs12208357       <NA>             <NA>
#> 98473        G       A  rs2279463       <NA>             <NA>
#> 114743       A       G  rs2208338       <NA>             <NA>
#> 124749       A       G  rs3757130       <NA>             <NA>
#> 124775       A       G  rs2762353       <NA>             <NA>
#> 124777       G       A  rs1165213       <NA>             <NA>
#> 124788       A       G  rs9461218       <NA>             <NA>
#> 124792       A       G  rs1165152       <NA>             <NA>
#> 124800       T       G  rs1165151       <NA>             <NA>
#> 125080       G       A  rs9379832       <NA>             <NA>
#> 140728       G       A   rs881858       <NA>             <NA>
#> 184948       T       C rs10872424       <NA>             <NA>
#> 193827       A       G  rs6464114       <NA>             <NA>
#> 193830       T       G  rs6977081       <NA>             <NA>
#> 194543       A       G  rs7805747       <NA>             <NA>
#> 194848       G       A  rs1019173       <NA>             <NA>
#> 198844       G       T  rs1242780       <NA>             <NA>
#> 210679       A       G rs11764932       <NA>             <NA>
#> 215696       G       A rs17364464       <NA>             <NA>
#> 243283       C       T  rs6465825       <NA>             <NA>
#> 254606       T       C   rs776746       <NA>             <NA>
#> 254626       G       T rs45446698       <NA>             <NA>
#> 255308       T       C  rs7780766       <NA>             <NA>
#> 280318       A       G  rs4292733       <NA>             <NA>
#> 295522       C       T  rs4921914       <NA>             <NA>
#> 295524       G       A  rs1495741       <NA>             <NA>
#> 300234       T       C rs10109414       <NA>             <NA>
#> 305533       A       G  rs2439312       <NA>             <NA>
#> 346098       C       T rs17232789       <NA>             <NA>
#> 350168       A       G  rs2648875       <NA>             <NA>
#> 393593       G       T  rs6560517       <NA>             <NA>
#> 398552       C       T  rs1020120       <NA>             <NA>
#> 405470       G       A  rs9785234       <NA>             <NA>
#> 422359       A       C  rs1771792       <NA>             <NA>
#> 425594       A       G  rs7849270       <NA>             <NA>
#> 431874       G       A rs10783124       <NA>             <NA>
#> 436568       A       C  rs1933182       <NA>             <NA>
#> 441143       G       A     rs2790       <NA>             <NA>
#> 453810       A       C rs16942751       <NA>             <NA>
#> 470261       C       T rs12963285       <NA>             <NA>
#> 504292       G       A  rs4805497       <NA>             <NA>
#> 505713       T       C  rs4805801       <NA>             <NA>
#> 505785       C       T rs12460876       <NA>             <NA>
#> 505786       C       T rs12460876       <NA>             <NA>
#> 522142       C       T   rs267734       <NA>             <NA>
#> 522616       C       T  rs6657658       <NA>             <NA>
#> 522629       T       C  rs6587640       <NA>             <NA>
#> 534351       A       G  rs6036759       <NA>             <NA>
#> 545314       A       G  rs4814615       <NA>             <NA>
#> 549435       C       T   rs911119       <NA>             <NA>
#> 554416       G       A   rs926392       <NA>             <NA>
#> 559149       A       G  rs6066043       <NA>             <NA>
#> 563049       T       C  rs6022039       <NA>             <NA>
#> 578225       T       C  rs1032843       <NA>             <NA>
#> 590556       A       G  rs2823139       <NA>             <NA>
#> 604260       C       T  rs9977499       <NA>             <NA>
#> 604270       A       G  rs1452093       <NA>             <NA>
#>                                          gen_ckd
#> 17694                                      RGS14
#> 17707                                    SLC34A1
#> 17712     RGS14,PRR7,PFN3,GRK6,SLC34A1,F12,LMAN2
#> 17713                                    SLC34A1
#> 36481                                      AGXT2
#> 38806                                       DAB2
#> 98368                                    SLC22A1
#> 98473                                    SLC22A2
#> 114743                                    ELOVL2
#> 124749                   SLC17A1,SLC17A3,SLC17A4
#> 124775                   SLC17A1,SLC17A3,SLC17A4
#> 124777                   SLC17A1,SLC17A3,SLC17A4
#> 124788                   SLC17A1,SLC17A3,SLC17A4
#> 124792                   SLC17A1,SLC17A3,SLC17A4
#> 124800                   SLC17A1,SLC17A3,SLC17A4
#> 125080                                 HIST1H2BE
#> 140728                                     VEGFA
#> 184948                                 LOC154092
#> 193827                                      AOC1
#> 193830                                      AOC1
#> 194543                                    PRKAG2
#> 194848               GALNTL5,GALNT11,MLL3,CCT8L1
#> 198844                                    PTPRN2
#> 210679                                     MEOX2
#> 215696                               RAPGEF5,IL6
#> 243283                       PHTF2,RSBN1L,TMEM60
#> 254606                                    CYP3A5
#> 254626                                    CYP3A7
#> 255308                              MOGAT3,AP1S1
#> 280318                                  ARHGEF10
#> 295522                                      NAT2
#> 295524                                      NAT2
#> 300234                                      STC1
#> 305533                                      NRG1
#> 346098                                      HAS2
#> 350168                                      PVT1
#> 393593                              GCNT1,RPSAP9
#> 398552                             SLC28A3,NTRK2
#> 405470                         LOC158434,HSD17B3
#> 422359                               OR1J1,PTGS1
#> 425594                                    PPP2R4
#> 431874                               AGL,SLC35A3
#> 436568 AMIGO1,SORT1,ATXN7L2,SYPL2,CYB561D1,PSMA5
#> 441143                                      TYMS
#> 453810                                      AQP4
#> 470261                                  LINC-ROR
#> 504292                                      URI1
#> 505713                                    SLC7A9
#> 505785                      CCDC123,ECAT8,SLC7A9
#> 505786                                    SLC7A9
#> 522142     SETDB1,LASS2,ANXA9,PRUNE,FAM63A,BNIPL
#> 522616                             THEM4,S100A10
#> 522629                                   S100A10
#> 534351                               ZNF343,TMC2
#> 545314                                     PCSK2
#> 549435                            CST9,CST3,CST4
#> 554416                           DHX35,LOC339568
#> 559149                                   SLC13A3
#> 563049                               ZFP64,TSHZ2
#> 578225                                      FIGN
#> 590556                                     NRIP1
#> 604260                        NCRNA00113,ADAMTS5
#> 604270                        NCRNA00113,ADAMTS5
# Plot: coffee SNPs as circles, preeclampsia SNPs as triangles, CKD SNPs as squares
ggplot() +
  geom_point(data = coffee_snps, aes(x = PC1, y = PC2, color = gen_coffee), shape = 16, size = 2, alpha = 0.7) +
  geom_point(data = preeclampsia_snps, aes(x = PC1, y = PC2, color = gen_preeclampsia), shape = 17, size = 3, alpha = 0.7) +
  geom_point(data = ckd_snps, aes(x = PC1, y = PC2, color = gen_ckd), shape = 15, size = 3, alpha = 0.7) +
  labs(title = "PC1 vs PC2: coffee (circles), preeclampsia (triangles), CKD (squares)") +
  theme_minimal() +
  guides(color = "none")
```

<img src="docs/README-unnamed-chunk-9-1.png" width="100%" />

------------------------------------------------------------------------

- All file sizes are displayed after each step for transparency.
- Remote parquet files are previewed before local processing.
- For large datasets, consider subsampling for faster plotting.
- Use `overwrite = FALSE` for DuckDB and houba steps to avoid slow
  download and reuse existing files.
